{"ast":null,"code":"import React,{useState,useEffect,useContext}from'react';import axios from'axios';import{Link}from'react-router-dom';import AuthContext from'../../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RecordServiceUsagePage=()=>{const[services,setServices]=useState([]);// State for the services dropdown\nconst[selectedMemberId,setSelectedMemberId]=useState('');const[selectedServiceId,setSelectedServiceId]=useState('');const[duration,setDuration]=useState(60);const[notes,setNotes]=useState('');const[error,setError]=useState('');const[success,setSuccess]=useState('');const[isSubmitting,setIsSubmitting]=useState(false);// Still need the token for the POST request\nconst auth=useContext(AuthContext);// This useEffect now runs once on mount to fetch the public list of services\nuseEffect(()=>{const fetchServices=async()=>{try{// This is now a public API call, no token needed\nconst res=await axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/services\"));setServices(res.data);// If services are loaded, set the default selection\nif(res.data.length>0){setSelectedServiceId(res.data[0].service_id);}}catch(err){setError(\"Không thể tải danh sách dịch vụ.\");console.error(\"Fetch services error:\",err);}};fetchServices();},[]);// Empty dependency array `[]` makes it run only once.\nconst handleSubmit=async e=>{e.preventDefault();setIsSubmitting(true);setError('');setSuccess('');// Check for token before making the protected POST request\nif(!auth||!auth.token){setError(\"Lỗi xác thực. Vui lòng đăng nhập lại.\");setIsSubmitting(false);return;}if(!selectedMemberId||!selectedServiceId){setError('Vui lòng chọn hội viên và loại dịch vụ.');setIsSubmitting(false);return;}try{const config={headers:{Authorization:\"Bearer \".concat(auth.token)}};const body={memberId:Number(selectedMemberId),serviceDate:new Date().toISOString(),serviceId:Number(selectedServiceId),durationMinutes:Number(duration),notes};const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/service-history\"),body,config);setSuccess(res.data.msg);setSelectedMemberId('');setNotes('');}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.msg)||'Ghi nhận thất bại.');}finally{setIsSubmitting(false);}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Link,{to:\"/dashboard\",children:\"\\u2190 Quay l\\u1EA1i Dashboard\"}),/*#__PURE__*/_jsx(\"h2\",{style:{marginTop:'1rem'},children:\"Ghi nh\\u1EADn L\\u1ECBch s\\u1EED D\\u1ECBch v\\u1EE5\"}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:'red'},children:error}),success&&/*#__PURE__*/_jsx(\"p\",{style:{color:'green'},children:success}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"ID H\\u1ED9i vi\\xEAn:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"Nh\\u1EADp ID c\\u1EE7a h\\u1ED9i vi\\xEAn...\",value:selectedMemberId,onChange:e=>setSelectedMemberId(e.target.value),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Lo\\u1EA1i D\\u1ECBch v\\u1EE5:\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedServiceId,onChange:e=>setSelectedServiceId(e.target.value),required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"-- Ch\\u1ECDn d\\u1ECBch v\\u1EE5 --\"}),services.map(service=>/*#__PURE__*/_jsx(\"option\",{value:service.service_id,children:service.service_name},service.service_id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Th\\u1EDDi l\\u01B0\\u1EE3ng (ph\\xFAt):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:duration,onChange:e=>setDuration(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Ghi ch\\xFA (t\\xF9y ch\\u1ECDn):\"}),/*#__PURE__*/_jsx(\"textarea\",{value:notes,onChange:e=>setNotes(e.target.value),rows:\"3\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isSubmitting,children:isSubmitting?'Đang ghi nhận...':'Ghi nhận'})]})]});};export default RecordServiceUsagePage;","map":{"version":3,"names":["React","useState","useEffect","useContext","axios","Link","AuthContext","jsx","_jsx","jsxs","_jsxs","RecordServiceUsagePage","services","setServices","selectedMemberId","setSelectedMemberId","selectedServiceId","setSelectedServiceId","duration","setDuration","notes","setNotes","error","setError","success","setSuccess","isSubmitting","setIsSubmitting","auth","fetchServices","res","get","concat","process","env","REACT_APP_API_URL","data","length","service_id","err","console","handleSubmit","e","preventDefault","token","config","headers","Authorization","body","memberId","Number","serviceDate","Date","toISOString","serviceId","durationMinutes","post","msg","_err$response","_err$response$data","response","children","to","style","marginTop","color","onSubmit","type","placeholder","value","onChange","target","required","disabled","map","service","service_name","rows"],"sources":["D:/GITHUB/IT4549-156729-Group16/frontend/src/pages/Staff/RecordServiceUsagePage.jsx"],"sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\r\nimport axios from 'axios';\r\nimport { Link } from 'react-router-dom';\r\nimport AuthContext from '../../contexts/AuthContext';\r\n\r\nconst RecordServiceUsagePage = () => {\r\n  const [services, setServices] = useState([]); // State for the services dropdown\r\n  const [selectedMemberId, setSelectedMemberId] = useState('');\r\n  const [selectedServiceId, setSelectedServiceId] = useState('');\r\n  const [duration, setDuration] = useState(60);\r\n  const [notes, setNotes] = useState('');\r\n\r\n  const [error, setError] = useState('');\r\n  const [success, setSuccess] = useState('');\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  // Still need the token for the POST request\r\n  const auth = useContext(AuthContext);\r\n\r\n  // This useEffect now runs once on mount to fetch the public list of services\r\n  useEffect(() => {\r\n    const fetchServices = async () => {\r\n      try {\r\n        // This is now a public API call, no token needed\r\n        const res = await axios.get(`${process.env.REACT_APP_API_URL}/services`);\r\n        setServices(res.data);\r\n        // If services are loaded, set the default selection\r\n        if (res.data.length > 0) {\r\n          setSelectedServiceId(res.data[0].service_id);\r\n        }\r\n      } catch (err) {\r\n        setError(\"Không thể tải danh sách dịch vụ.\");\r\n        console.error(\"Fetch services error:\", err);\r\n      }\r\n    };\r\n    fetchServices();\r\n  }, []); // Empty dependency array `[]` makes it run only once.\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    setError('');\r\n    setSuccess('');\r\n\r\n    // Check for token before making the protected POST request\r\n    if (!auth || !auth.token) {\r\n        setError(\"Lỗi xác thực. Vui lòng đăng nhập lại.\");\r\n        setIsSubmitting(false);\r\n        return;\r\n    }\r\n\r\n    if (!selectedMemberId || !selectedServiceId) {\r\n      setError('Vui lòng chọn hội viên và loại dịch vụ.');\r\n      setIsSubmitting(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const config = { headers: { Authorization: `Bearer ${auth.token}` } };\r\n      const body = {\r\n        memberId: Number(selectedMemberId),\r\n        serviceDate: new Date().toISOString(),\r\n        serviceId: Number(selectedServiceId),\r\n        durationMinutes: Number(duration),\r\n        notes,\r\n      };\r\n\r\n      const res = await axios.post(`${process.env.REACT_APP_API_URL}/service-history`, body, config);\r\n      setSuccess(res.data.msg);\r\n      setSelectedMemberId('');\r\n      setNotes('');\r\n    } catch (err) {\r\n      setError(err.response?.data?.msg || 'Ghi nhận thất bại.');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <Link to=\"/dashboard\">← Quay lại Dashboard</Link>\r\n      <h2 style={{ marginTop: '1rem' }}>Ghi nhận Lịch sử Dịch vụ</h2>\r\n      \r\n      {error && <p style={{ color: 'red' }}>{error}</p>}\r\n      {success && <p style={{ color: 'green' }}>{success}</p>}\r\n\r\n      <form onSubmit={handleSubmit}>\r\n        <div>\r\n          <label>ID Hội viên:</label>\r\n          <input\r\n            type=\"number\"\r\n            placeholder=\"Nhập ID của hội viên...\"\r\n            value={selectedMemberId}\r\n            onChange={(e) => setSelectedMemberId(e.target.value)}\r\n            required\r\n          />\r\n        </div>\r\n        <div>\r\n          <label>Loại Dịch vụ:</label>\r\n          <select value={selectedServiceId} onChange={(e) => setSelectedServiceId(e.target.value)} required>\r\n            <option value=\"\" disabled>-- Chọn dịch vụ --</option>\r\n            {services.map(service => (\r\n                <option key={service.service_id} value={service.service_id}>\r\n                    {service.service_name}\r\n                </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n        <div>\r\n          <label>Thời lượng (phút):</label>\r\n          <input\r\n            type=\"number\"\r\n            value={duration}\r\n            onChange={(e) => setDuration(e.target.value)}\r\n          />\r\n        </div>\r\n        <div>\r\n          <label>Ghi chú (tùy chọn):</label>\r\n          <textarea\r\n            value={notes}\r\n            onChange={(e) => setNotes(e.target.value)}\r\n            rows=\"3\"\r\n          />\r\n        </div>\r\n        <button type=\"submit\" disabled={isSubmitting}>\r\n          {isSubmitting ? 'Đang ghi nhận...' : 'Ghi nhận'}\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RecordServiceUsagePage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}